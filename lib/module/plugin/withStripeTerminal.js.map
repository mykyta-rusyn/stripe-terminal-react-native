{"version":3,"names":["_configPlugins","require","pkg","withStripeTerminal","config","props","withStripeTerminalIos","withNoopSwiftFile","withStripeTerminalAndroid","withJetifierIgnoringJackson","expoConfig","withAndroidManifest","modResults","addBTPermissionToManifest","addLocationPermissionToManifest","withGradleProperties","push","key","value","type","androidManifest","Array","isArray","manifest","find","item","$","_androidManifest$mani","_androidManifest$mani2","_androidManifest$mani3","_androidManifest$mani4","withInfoPlist","bluetoothBackgroundMode","_config$modResults$UI","UIBackgroundModes","concat","_toConsumableArray2","default","NSLocationWhenInUseUsageDescription","locationWhenInUsePermission","NSBluetoothPeripheralUsageDescription","bluetoothPeripheralPermission","NSBluetoothAlwaysUsageDescription","bluetoothAlwaysUsagePermission","NSLocalNetworkUsageDescription","localNetworkUsagePermission","exports","IOSConfig","XcodeProjectFile","withBuildSourceFile","filePath","contents","join","_default","createRunOncePlugin","name","version"],"sources":["withStripeTerminal.ts"],"sourcesContent":["import {\n  type ConfigPlugin,\n  createRunOncePlugin,\n  IOSConfig,\n  withInfoPlist,\n  withAndroidManifest,\n  withGradleProperties,\n  AndroidConfig,\n} from '@expo/config-plugins';\n\ntype InnerManifest = AndroidConfig.Manifest.AndroidManifest['manifest'];\n\ntype ManifestPermission = InnerManifest['permission'];\n\ntype AndroidManifest = {\n  manifest: InnerManifest & {\n    'permission'?: ManifestPermission;\n    'uses-permission'?: InnerManifest['uses-permission'];\n    'uses-feature'?: InnerManifest['uses-feature'];\n  };\n};\n\nconst pkg = require('@stripe/stripe-terminal-react-native/package.json');\n\ntype StripeTerminalPluginProps = {\n  bluetoothBackgroundMode?: boolean;\n  locationWhenInUsePermission?: string;\n  bluetoothPeripheralPermission?: string;\n  bluetoothAlwaysUsagePermission?: string;\n  localNetworkUsagePermission?: string;\n};\n\nconst withStripeTerminal: ConfigPlugin<StripeTerminalPluginProps> = (\n  config,\n  props\n) => {\n  config = withStripeTerminalIos(config, props);\n  config = withNoopSwiftFile(config);\n  config = withStripeTerminalAndroid(config);\n  config = withJetifierIgnoringJackson(config);\n\n  return config;\n};\n\nconst withStripeTerminalAndroid: ConfigPlugin = (expoConfig) => {\n  return withAndroidManifest(expoConfig, (config) => {\n    config.modResults = addBTPermissionToManifest(config.modResults);\n    config.modResults = addLocationPermissionToManifest(config.modResults);\n\n    return config;\n  });\n};\n\nconst withJetifierIgnoringJackson: ConfigPlugin = (expoConfig) => {\n  return withGradleProperties(expoConfig, (config) => {\n    config.modResults.push({\n      key: 'android.jetifier.ignorelist',\n      value: 'jackson-core',\n      type: 'property',\n    });\n\n    return config;\n  });\n};\n\nexport function addLocationPermissionToManifest(\n  androidManifest: AndroidManifest\n) {\n  if (!Array.isArray(androidManifest.manifest['uses-permission'])) {\n    androidManifest.manifest['uses-permission'] = [];\n  }\n\n  if (\n    !androidManifest.manifest['uses-permission'].find(\n      (item) =>\n        item.$['android:name'] === 'android.permission.ACCESS_FINE_LOCATION'\n    )\n  ) {\n    androidManifest.manifest['uses-permission']?.push({\n      $: {\n        'android:name': 'android.permission.ACCESS_FINE_LOCATION',\n      },\n    });\n  }\n\n  if (\n    !androidManifest.manifest['uses-permission'].find(\n      (item) =>\n        item.$['android:name'] === 'android.permission.ACCESS_COARSE_LOCATION'\n    )\n  ) {\n    androidManifest.manifest['uses-permission']?.push({\n      $: {\n        'android:name': 'android.permission.ACCESS_COARSE_LOCATION',\n      },\n    });\n  }\n  return androidManifest;\n}\n\nexport function addBTPermissionToManifest(androidManifest: AndroidManifest) {\n  // Add `<uses-permission android:name=\"android.permission.BLUETOOTH_CONNECT/SCAN\"/>` to the AndroidManifest.xml\n  if (!Array.isArray(androidManifest.manifest['uses-permission'])) {\n    androidManifest.manifest['uses-permission'] = [];\n  }\n\n  if (\n    !androidManifest.manifest['uses-permission'].find(\n      (item) =>\n        item.$['android:name'] === 'android.permission.BLUETOOTH_CONNECT'\n    )\n  ) {\n    androidManifest.manifest['uses-permission']?.push({\n      $: {\n        'android:name': 'android.permission.BLUETOOTH_CONNECT',\n      },\n    });\n  }\n\n  if (\n    !androidManifest.manifest['uses-permission'].find(\n      (item) => item.$['android:name'] === 'android.permission.BLUETOOTH_SCAN'\n    )\n  ) {\n    androidManifest.manifest['uses-permission']?.push({\n      $: {\n        'android:name': 'android.permission.BLUETOOTH_SCAN',\n      },\n    });\n  }\n  return androidManifest;\n}\n\n/**\n * Grant bluetooth and location permissions.\n */\nconst withStripeTerminalIos: ConfigPlugin<StripeTerminalPluginProps> = (\n  expoConfig,\n  props\n) => {\n  return withInfoPlist(expoConfig, (config) => {\n    if (props.bluetoothBackgroundMode) {\n      config.modResults.UIBackgroundModes = [\n        ...(config.modResults.UIBackgroundModes ?? []),\n        'bluetooth-central',\n      ];\n    }\n\n    config.modResults.NSLocationWhenInUseUsageDescription =\n      props.locationWhenInUsePermission ||\n      'Location access is required in order to accept payments.';\n\n    config.modResults.NSBluetoothPeripheralUsageDescription =\n      props.bluetoothPeripheralPermission ||\n      'Bluetooth access is required in order to connect to supported bluetooth card readers.';\n\n    config.modResults.NSBluetoothAlwaysUsageDescription =\n      props.bluetoothAlwaysUsagePermission ||\n      'This app uses Bluetooth to connect to supported card readers.';\n\n    config.modResults.NSLocalNetworkUsageDescription =\n      props.localNetworkUsagePermission ||\n      'This app uses the local WiFi network to connect to supported card readers.';\n    return config;\n  });\n};\n\n/**\n * Add a blank Swift file to the Xcode project for Swift compatibility.\n */\nexport const withNoopSwiftFile: ConfigPlugin = (config) => {\n  return IOSConfig.XcodeProjectFile.withBuildSourceFile(config, {\n    filePath: 'noop-file.swift',\n    contents: [\n      '//',\n      '// @generated',\n      '// A blank Swift file must be created for native modules with Swift files to work correctly.',\n      '//',\n      '',\n    ].join('\\n'),\n  });\n};\n\nexport default createRunOncePlugin(withStripeTerminal, pkg.name, pkg.version);\n"],"mappings":"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","ignoreList":[]}